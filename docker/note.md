# docker
## docker是什么
Docker 使用 Google 公司推出的 Go 语言 进行开发实现，基于 Linux 内核 的cgroup，namespace，以及AUFS类的UnionFS等技术，对进程进行封装隔离，属于操作系统层面的虚拟化技术。 由于隔离的进程独立于宿主和其它的隔离的进程，因此也称其为容器。
## docker 分层
docker镜像是利用Union FS技术实现的多层文件系统联合,每个镜像层都是一个只读的文件系统，可以包含文件、目录、依赖库、运行时环境,以及运行时配置参数等。这些层按照从底部到顶部的顺序叠加在一起，形成了一个完整的镜像。底部的分层通常是一个基础操作系统的根文件系统，而顶部的分层包含了应用程序代码和配置等信息

镜像不包含任何动态数据，其内容在构建之后也不会被改变

镜像构建时，会一层层构建，前一层是后一层的基础。每一层构建完就不会再发生改变，后一层上的任何改变只发生在自己这一层。　比如，删除前一层文件的操作，实际不是真的删除前一层的文件，而是仅在当前层标记为该文件已删除。在最终容器运行的时候，虽然不会看到这个文件，但是实际上该文件会一直跟随镜像。


当基于镜像创建一个容器时，Docker会在镜像的顶部添加一个可读写的容器层。这个容器层允许容器在运行时对文件系统进行写操作，例如应用程序的日志输出、数据库文件等。容器层是临时的，只在容器运行时存在，当容器停止时，对容器层的修改也会被丢弃，保持镜像的不可变性。

Docker镜像支持分层继承，这意味着可以基于现有的镜像构建新的镜像。当新的镜像构建时，它只需在现有镜像的基础上添加新的分层，而不需要重新复制现有的分层。这种分层继承的特性使得镜像构建变得高效和快速，并允许镜像的复用。


构建镜像的时候，需要额外小心，每一层尽量只包含该层需要添加的东西，任何额外的东西应该在该层构建结束前清理掉
## 注意事项
### 容器的数据写入
按照 Docker 最佳实践的要求，容器不应该向其存储层内写入任何数据 ，容器存储层要保持无状态化。所有的文件写入操作，都应该使用数据卷（Volume）、或者绑定宿主目录，在这些位置的读写会跳过容器存储层，直接对宿主(或网络存储)发生读写，其性能和稳定性更高。数据卷的生存周期独立于容器，容器消亡，数据卷不会消亡。因此， 使用数据卷后，容器可以随意删除、重新 run ，数据却不会丢失
### 用户组
Docker 的守护线程绑定的是 unix socket，而不是 TCP 端口，这个套接字默认属于 root，其他用户可以通过sudo 去访问这个套接字文件。所以 docker 服务进程都是以 root 账户运行。

解决的方式是创建 docker 用户组，把应用用户加入到 docker 用户组里面。只要 docker 组里的用户都可以直接执行 docker 命令。

